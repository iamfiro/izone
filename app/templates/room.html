{% load static %}

<!DOCTYPE html>
<html>
  <head>
    <title>{{ room.name }}</title>
    <link rel="stylesheet" href="{% static 'css/global.css' %}">
    <style>
      :root {
        --primary-color: #5339f9;
        --inactive-color: #9e9e9e;
        --background-light: #f8f9fa;
        --text-dark: #333;
        --text-light: #666;
        --border-color: #e0e0e0;
      }

      header {
        width: 100%;
        height: 80px;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
      }

      .header-left {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .title {
        font-size: 20px;
        font-weight: 500;
        color: var(--text-dark);
      }

      .description {
        font-size: 16px;
        font-weight: 400;
        color: var(--text-light);
      }

      .quit {
        background-color: #f93c39;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 999px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      .quit:hover {
        background-color: #e53935;
        transform: translateY(-2px);
      }

      .room-main {
        width: 100%;
        height: calc(100vh - 80px);
        display: flex;
      }

      .room-left {
        width: calc(100% - 450px);
        height: 100%;
        padding: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }

      .cam {
        background: linear-gradient(135deg, var(--primary-color), #7c4dff);
        width: 300px;
        aspect-ratio: 12/9;
        border-radius: 18px;
      }

      #status {
        font-size: 18px;
        font-weight: 500;
        padding: 8px 16px;
        border-radius: 20px;
        background: white;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        color: var(--text-dark);
      }

      .user-list {
        width: 100%;
        max-width: 500px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .user-timer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
      }

      .user-timer.active {
        background: linear-gradient(135deg, #fff, #f8f6ff);
        transform: translateX(5px);
      }

      .user-timer.inactive {
        background: #f5f5f5;
        opacity: 0.7;
      }

      .user-name {
        font-size: 16px;
        font-weight: 500;
        color: var(--text-dark);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .user-name::before {
        content: "ğŸ‘¤";
        font-size: 14px;
      }

      .user-timer.active .user-name {
        color: var(--primary-color);
      }

      .user-timer.inactive .user-name {
        color: var(--inactive-color);
      }

      .timer {
        font-size: 18px;
        font-weight: 600;
        font-family: 'Courier New', monospace;
        color: var(--text-dark);
        background: var(--background-light);
        padding: 6px 12px;
        border-radius: 8px;
      }

      .user-timer.active .timer {
        color: var(--primary-color);
        background: #f0edff;
      }

      .user-timer.inactive .timer {
        color: var(--inactive-color);
        background: #f0f0f0;
      }

      .room-right {
        width: 450px;
        height: 100%;
        background: white;
      }

      .room-timer-container {
        width: calc(100% - 30px);
        height: 170px;
        margin: 15px;
        border-radius: 18px;
        background: linear-gradient(135deg, var(--primary-color), #7c4dff);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 5px;
        color: white;
      }

      .room-timer-container > h2 {
        font-size: 50px;
        font-weight: 600;
        font-family: 'Courier New', monospace;
        margin: 0;
      }

      .room-timer-container > span {
        font-size: 22px;
        font-weight: 400;
        opacity: 0.9;
      }

      .room-leaderboard-container {
        width: calc(100% - 30px);
        height: calc(100% - 200px);
        margin: 15px;
        border-radius: 18px;
        border: 1px solid var(--border-color);
        background: white;
        display: flex;
        flex-direction: column;
        padding: 20px;
      }

      .leaderboard-title {
        font-size: 22px;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 20px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .leaderboard-title::before {
        content: "ğŸ†";
        font-size: 20px;
      }

      .room-leaderboard-list {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        gap: 12px;
        overflow-y: auto;
      }

      .leaderboard-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px;
        background: var(--background-light);
        border-radius: 12px;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
      }

      .leaderboard-item:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      }

      .leaderboard-item.rank-1 {
        background: linear-gradient(135deg, #ffd700, #ffed4a);
        border-left-color: #ffd700;
      }

      .leaderboard-item.rank-2 {
        background: linear-gradient(135deg, #c0c0c0, #e2e8f0);
        border-left-color: #c0c0c0;
      }

      .leaderboard-item.rank-3 {
        background: linear-gradient(135deg, #cd7f32, #d69e2e);
        border-left-color: #cd7f32;
      }

      .rank-info {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .rank-number {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: var(--primary-color);
        color: white;
        font-weight: 600;
        font-size: 14px;
      }

      .leaderboard-item.rank-1 .rank-number {
        background: #ffd700;
        color: #333;
      }

      .leaderboard-item.rank-2 .rank-number {
        background: #c0c0c0;
        color: #333;
      }

      .leaderboard-item.rank-3 .rank-number {
        background: #cd7f32;
        color: white;
      }

      /* í˜„ì¬ ì‚¬ìš©ì ìŠ¤íƒ€ì¼ (ë…¸ë€ìƒ‰) */
      .leaderboard-item.current-user {
        background: linear-gradient(135deg, #ffd700, #ffed4a) !important;
        border-left-color: #ffd700 !important;
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
      }

      .leaderboard-item.current-user .rank-number {
        background: #ffd700 !important;
        color: #333 !important;
      }

      .leaderboard-item.current-user .player-name {
        font-weight: 600;
        color: #333 !important;
      }

      .leaderboard-item.current-user .player-time {
        color: #333 !important;
        font-weight: 700;
      }

      /* ë‹¤ë¥¸ ì‚¬ìš©ì ìŠ¤íƒ€ì¼ (íšŒìƒ‰) */
      .leaderboard-item.other-user {
        background: linear-gradient(135deg, #e2e8f0, #cbd5e0) !important;
        border-left-color: #94a3b8 !important;
      }

      .leaderboard-item.other-user .rank-number {
        background: #94a3b8 !important;
        color: white !important;
      }

      .leaderboard-item.other-user .player-name {
        color: #64748b !important;
      }

      .leaderboard-item.other-user .player-time {
        color: #64748b !important;
      }

      .player-name {
        font-size: 16px;
        font-weight: 500;
        color: var(--text-dark);
      }

      .player-time {
        font-size: 16px;
        font-weight: 600;
        font-family: 'Courier New', monospace;
        color: var(--primary-color);
      }

      .empty-leaderboard {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: var(--text-light);
        font-size: 16px;
      }

      .empty-leaderboard::before {
        content: "ğŸ“Š";
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header-left">
        <h1 class="title">{{ room.name }}</h1>
        <p class="description">{{ room.description }}</p>
      </div>
      <a href="/" class="quit">ë°© ë‚˜ê°€ê¸°</a>
    </header>
    <main class="room-main">
      <div class="room-left">
        <video class="cam" id="cam" autoplay playsinline></video>
        <span id="status">ì¤€ë¹„ì¤‘</span>
        <div class="user-list" id="user-list">
          <!-- ìœ ì € íƒ€ì´ë¨¸ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
      </div>
      <div class="room-right">
        <div class="room-timer-container">
          <span>íƒ€ì´ë¨¸</span>
          <h2 id="timer">00:00</h2>
        </div>
        <div class="room-leaderboard-container">
          <div class="leaderboard-title">ë­í‚¹</div>
          <div class="room-leaderboard-list" id="leaderboard-list">
            <div class="empty-leaderboard">
              ì•„ì§ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤
            </div>
          </div>
        </div>
      </div>
      <button>ë†€ë¦¬ê¸°</button>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.16.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
    <script src="{% static 'js/timer.js' %}"></script>
    <script src="{% static 'js/webcam.js' %}"></script>
    <script>
      const jsConfetti = new JSConfetti()
      // ìœ ì € ì •ë³´ í™•ì¸
      const userId = "{{ user.id|default:'' }}";
      const userName = "{{ user.username|default:'' }}";
      const roomId = "{{ room.id|default:'' }}";
      
      // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
      window.userId = userId;
      window.userName = userName;
      window.roomId = roomId;

      const confettiButton = document.querySelector('button');

      // ë¦¬ë”ë³´ë“œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateLeaderboard() {
        if (!window.timerManager) return;
        
        const leaderboardList = document.getElementById('leaderboard-list');
        const timers = window.timerManager.getAllTimers();
        
        // í˜„ì¬ ì‚¬ìš©ìì˜ íƒ€ì´ë¨¸ ì •ë³´ ì¶”ê°€
        const allTimers = [...timers];
        
        // í˜„ì¬ ì‚¬ìš©ìê°€ íƒ€ì´ë¨¸ ëª©ë¡ì— ì—†ìœ¼ë©´ ì¶”ê°€
        const currentUserExists = timers.some(timer => timer.userId === window.userId);
        if (!currentUserExists && window.userId && window.userName) {
          // í˜„ì¬ ì‚¬ìš©ìì˜ ì‹œê°„ì„ ë©”ì¸ íƒ€ì´ë¨¸ì—ì„œ ê°€ì ¸ì˜¤ê¸°
          const mainTimerElement = document.getElementById('timer');
          const mainTimerText = mainTimerElement ? mainTimerElement.textContent : '00:00';
          const [minutes, seconds] = mainTimerText.split(':').map(Number);
          const totalSeconds = (minutes * 60) + seconds;
          
          allTimers.push({
            userId: window.userId,
            userName: window.userName,
            seconds: totalSeconds,
            isCurrentUser: true
          });
        } else {
          // ê¸°ì¡´ íƒ€ì´ë¨¸ì— í˜„ì¬ ì‚¬ìš©ì í‘œì‹œ ì¶”ê°€
          allTimers.forEach(timer => {
            timer.isCurrentUser = timer.userId === window.userId;
          });
        }
        
        if (allTimers.length === 0) {
          leaderboardList.innerHTML = '<div class="empty-leaderboard">ì•„ì§ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤</div>';
          return;
        }
        
        // ì‹œê°„ ìˆœìœ¼ë¡œ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ)
        const sortedTimers = allTimers.sort((a, b) => b.seconds - a.seconds);
        
        leaderboardList.innerHTML = '';
        sortedTimers.forEach((timer, index) => {
          const rank = index + 1;
          const minutes = Math.floor(timer.seconds / 60);
          const seconds = timer.seconds % 60;
          const timeString = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
          
          const leaderboardItem = document.createElement('div');
          const isCurrentUser = timer.isCurrentUser || timer.userId === window.userId;
          
          // í˜„ì¬ ì‚¬ìš©ìì™€ ë‹¤ë¥¸ ì‚¬ìš©ìì— ë”°ë¼ ë‹¤ë¥¸ í´ë˜ìŠ¤ ì ìš©
          let itemClass = `leaderboard-item rank-${rank <= 3 ? rank : 'other'}`;
          if (isCurrentUser) {
            itemClass += ' current-user';
          } else {
            itemClass += ' other-user';
          }
          
          leaderboardItem.className = itemClass;
          leaderboardItem.innerHTML = `
            <div class="rank-info">
              <div class="rank-number">${rank}</div>
              <div class="player-name">${timer.userName}${isCurrentUser ? ' (ë‚˜)' : ''}</div>
            </div>
            <div class="player-time">${timeString}</div>
          `;
          leaderboardList.appendChild(leaderboardItem);
        });
      }

      // ë¦¬ë”ë³´ë“œ ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
      setInterval(updateLeaderboard, 1000);

      console.log("User Info:", { userId, userName, roomId });

      if (!userId || !userName || !roomId) {
        console.error("í•„ìˆ˜ ì •ë³´ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤:", { userId, userName, roomId });
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•˜ê±°ë‚˜ ë°© ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        window.location.href = "/";
      } else {
        // WebSocket ì—°ê²°
        const wsScheme = window.location.protocol === "https:" ? "wss" : "ws";
        const wsUrl = `${wsScheme}://${window.location.host}/ws/room/${roomId}/?user_id=${userId}&user_name=${encodeURIComponent(userName)}`;
        
        console.log("WebSocket URL:", wsUrl);
        
        const socket = new WebSocket(wsUrl);
        window.socket = socket;

        socket.onopen = function() {
          console.log("WebSocket ì—°ê²°ë¨");
          document.getElementById('status').textContent = 'ì—°ê²°ë¨';
        };

        socket.onmessage = function(event) {
          const data = JSON.parse(event.data);
          console.log("ì„œë²„ ë©”ì‹œì§€:", data);

          switch(data.type) {
            case 'user_list':
              // ì´ˆê¸° ìœ ì € ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬
              console.log("ìœ ì € ëª©ë¡ ìˆ˜ì‹ :", data.users);
              
              // ê¸°ì¡´ ìœ ì € ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
              const userList = document.getElementById('user-list');
              userList.innerHTML = '';
              
              Object.entries(data.users).forEach(([userId, userData]) => {
                if (userId !== window.userId) {
                  const timerElement = document.createElement('div');
                  timerElement.className = 'user-timer';
                  timerElement.innerHTML = `
                    <div class="user-name">${userData.user_name}</div>
                    <div class="timer">00:00</div>
                  `;
                  userList.appendChild(timerElement);
                  
                  // TimerManagerë¥¼ ì‚¬ìš©í•˜ì—¬ íƒ€ì´ë¨¸ ì¶”ê°€
                  if (window.timerManager) {
                    const timer = window.timerManager.addTimer(
                      userId,
                      userData.user_name,
                      timerElement.querySelector('.timer'),
                      timerElement
                    );
                    
                    // ê¸°ì¡´ ì‚¬ìš©ìì˜ ëˆ„ì  ì‹œê°„ ì„¤ì •
                    timer.seconds = userData.timer || 0;
                    timer.updateTimerDisplay();
                    
                    console.log(`ì‚¬ìš©ì ${userData.user_name}ì˜ ì‹œê°„ ì„¤ì •: ${timer.seconds}ì´ˆ`);
                    
                    // ìƒíƒœì— ë”°ë¼ íƒ€ì´ë¨¸ ì‹œì‘/ì¤‘ì§€
                    if (userData.present) {
                      timer.resumeTimer();
                      console.log(`ì‚¬ìš©ì ${userData.user_name} íƒ€ì´ë¨¸ ì¬ê°œ`);
                    } else {
                      console.log(`ì‚¬ìš©ì ${userData.user_name} íƒ€ì´ë¨¸ ì •ì§€ ìƒíƒœ`);
                    }
                  }
                }
              });
              
              // ë¦¬ë”ë³´ë“œ ì—…ë°ì´íŠ¸
              updateLeaderboard();
              break;

            case 'user_joined':
              // ìƒˆ ìœ ì € ì…ì¥ ì²˜ë¦¬
              console.log("ìƒˆ ìœ ì € ì…ì¥:", data);
              const timerElement = document.createElement('div');
              timerElement.className = 'user-timer';
              timerElement.innerHTML = `
                  <div class="user-name">${data.user_name}</div>
                  <div class="timer">00:00</div>
              `;
              document.getElementById('user-list').appendChild(timerElement);
              
              if (window.timerManager) {
                window.timerManager.addTimer(
                    data.user_id,
                    data.user_name,
                    timerElement.querySelector('.timer'),
                    timerElement
                );
              }
              
              // ë¦¬ë”ë³´ë“œ ì—…ë°ì´íŠ¸
              updateLeaderboard();
              break;

            case 'user_left':
              // ìœ ì € ì™„ì „ í‡´ì¥ ì²˜ë¦¬
              console.log("ìœ ì € í‡´ì¥:", data);
              
              if (window.timerManager) {
                // TimerManagerì—ì„œ ì™„ì „íˆ ì œê±°
                window.timerManager.removeTimer(data.user_id);
                console.log(`ì‚¬ìš©ì ${data.user_name} íƒ€ì´ë¨¸ ì™„ì „ ì œê±°ë¨`);
              }
              
              // DOMì—ì„œ í•´ë‹¹ ìœ ì € ìš”ì†Œ ì™„ì „ ì œê±°
              const userTimers = document.querySelectorAll('.user-timer');
              userTimers.forEach(element => {
                const userName = element.querySelector('.user-name').textContent;
                if (userName === data.user_name) {
                  element.remove();
                  console.log(`ì‚¬ìš©ì ${data.user_name} UI ìš”ì†Œ ì œê±°ë¨`);
                }
              });
              
              // ì™„ì „ ì œê±° ë¡œê·¸
              if (data.final_removal) {
                console.log(`ì‚¬ìš©ì ${data.user_name}ì´ ë°©ì—ì„œ ì™„ì „íˆ í‡´ì¥í–ˆìŠµë‹ˆë‹¤.`);
              }
              
              // ë¦¬ë”ë³´ë“œ ì—…ë°ì´íŠ¸
              updateLeaderboard();
              break;

            case 'presence_broadcast':
              // ìœ ì € presence ìƒíƒœ ì—…ë°ì´íŠ¸ (ì—°ê²°ëœ ì‚¬ìš©ìë§Œ)
              console.log("Presence ì—…ë°ì´íŠ¸:", data);
              if (window.timerManager) {
                const timer = window.timerManager.getTimer(data.user_id);
                if (timer) {
                    // ì„œë²„ì—ì„œ ë°›ì€ ì •í™•í•œ ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                    timer.seconds = data.timer || 0;
                    timer.updateTimerDisplay();
                    
                    console.log(`ì‚¬ìš©ì ID ${data.user_id}ì˜ ì‹œê°„ ì—…ë°ì´íŠ¸: ${timer.seconds}ì´ˆ, Present: ${data.present}`);
                    
                    if (data.present) {
                        timer.resumeTimer();
                    } else {
                        timer.pauseTimer();
                    }
                } else {
                    console.warn(`ì‚¬ìš©ì ID ${data.user_id}ì˜ íƒ€ì´ë¨¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                }
              }
              break;

            case 'fuck_broadcast':
              // fuck ì´ë²¤íŠ¸ ì²˜ë¦¬
              console.log(`${data.user_name}ë‹˜ì´ fuck ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œì¼°ìŠµë‹ˆë‹¤!`);
              
              // JSConfettië¥¼ ì‚¬ìš©í•œ ë‹¤ì–‘í•œ confetti íš¨ê³¼
              jsConfetti.addConfetti();
              
              setTimeout(() => {
                jsConfetti.addConfetti({
                  emojis: ['ğŸ˜ˆ', 'ğŸ’¥', 'ğŸ”¥', 'âš¡', 'ğŸ’¢', 'ğŸ¤¬'],
                  emojiSize: 50,
                  confettiNumber: 40,
                });
              }, 300);
              
              // ê°œë¹¡ì¹˜ëŠ” fuck.png ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
              createCrazyFuckAnimation();
              
              // ì„ì‹œ ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ
              showTemporaryNotification(`${data.user_name}ë‹˜ì´ ë†€ë¦¬ê¸°ë¥¼ í–ˆìŠµë‹ˆë‹¤! ğŸ”¥ğŸ’¥`);
              break;
          }
        };

        socket.onerror = function(error) {
          console.error("WebSocket ì˜¤ë¥˜:", error);
          document.getElementById('status').textContent = 'ì—°ê²° ì˜¤ë¥˜';
        };

        socket.onclose = function(event) {
          console.log("WebSocket ì—°ê²° ì¢…ë£Œ:", event.code, event.reason);
          document.getElementById('status').textContent = 'ì—°ê²° ëŠê¹€';
        };

        // confetti ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ë„ JSConfetti í™œìš©
        confettiButton.addEventListener('click', function() {
          // í´ë¦­ ì‹œ ì¦‰ì‹œ confetti íš¨ê³¼
          jsConfetti.addConfetti({
            emojis: ['ğŸ˜ˆ', 'ğŸ’¥', 'ğŸ”¥', 'âš¡'],
            emojiSize: 30,
            confettiNumber: 50,
          });
          
          // ì„œë²„ë¡œ fuck ì´ë²¤íŠ¸ ì „ì†¡
          if (window.socket && window.socket.readyState === WebSocket.OPEN) {
            window.socket.send(JSON.stringify({
              type: 'fuck',
              user_id: window.userId,
              user_name: window.userName
            }));
            console.log('Fuck ì´ë²¤íŠ¸ ì „ì†¡ë¨');
          }
        });

        // ê°œë¹¡ì¹˜ëŠ” fuck.png ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜
        function createCrazyFuckAnimation() {
          // ì—¬ëŸ¬ ê°œì˜ ì´ë¯¸ì§€ë¥¼ ë™ì‹œì— ìƒì„±
          for (let i = 0; i < 9; i++) {
            setTimeout(() => {
              const fuckImg = document.createElement('img');
              fuckImg.src = '/static/fuck.png';
              fuckImg.className = 'crazy-fuck-animation';
              
              // ëœë¤ ì‹œì‘ ìœ„ì¹˜
              const startX = Math.random() * (window.innerWidth - 300); // ì´ë¯¸ì§€ í¬ê¸° ê³ ë ¤í•´ì„œ ì¡°ì •
              const startY = Math.random() * (window.innerHeight - 300);
              
              fuckImg.style.cssText = `
                position: fixed;
                left: ${startX}px;
                top: ${startY}px;
                width: 500px;
                height: 500px;
                z-index: 10000;
                pointer-events: none;
                animation: 
                  crazyRotate 0.08s infinite linear,
                  crazySizeChange 0.4s infinite ease-in-out,
                  crazyBounce 2.5s infinite ease-in-out,
                  crazyShake 0.03s infinite,
                  crazyColorChange 0.15s infinite,
                  crazyFadeOut 4s ease-in-out forwards;
                animation-delay: ${i * 0.15}s;
              `;
              
              document.body.appendChild(fuckImg);
              
              // 4ì´ˆ í›„ ì œê±° (ë” ì˜¤ë˜ ë³´ì´ë„ë¡)
              setTimeout(() => {
                if (fuckImg.parentNode) {
                  fuckImg.remove();
                }
              }, 4000);
            }, i * 150);
          }
        }

        // CSS ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ ì¶”ê°€ (ê¸°ì¡´ notification-stylesì™€ í•¨ê»˜)
        if (!document.querySelector('#crazy-animation-styles')) {
          const style = document.createElement('style');
          style.id = 'crazy-animation-styles';
          style.textContent = `
            @keyframes crazyRotate {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
            }
            
            @keyframes crazySizeChange {
              0%, 100% { transform: scale(1); }
              20% { transform: scale(2.5); }
              40% { transform: scale(0.3); }
              60% { transform: scale(3); }
              80% { transform: scale(0.5); }
            }
            
            @keyframes crazyBounce {
              0%, 20%, 50%, 80%, 100% {
                transform: translateY(0) translateX(0);
              }
              10% {
                transform: translateY(-80px) translateX(60px);
              }
              30% {
                transform: translateY(100px) translateX(-90px);
              }
              60% {
                transform: translateY(-60px) translateX(120px);
              }
              90% {
                transform: translateY(40px) translateX(-80px);
              }
            }
            
            @keyframes crazyShake {
              0%, 100% { transform: translateX(0) translateY(0); }
              25% { transform: translateX(-10px) translateY(-8px); }
              50% { transform: translateX(12px) translateY(10px); }
              75% { transform: translateX(-8px) translateY(6px); }
            }
            
            @keyframes crazyColorChange {
              0% { filter: hue-rotate(0deg) saturate(1); }
              25% { filter: hue-rotate(90deg) saturate(2); }
              50% { filter: hue-rotate(180deg) saturate(1.5); }
              75% { filter: hue-rotate(270deg) saturate(2.5); }
              100% { filter: hue-rotate(360deg) saturate(1); }
            }
            
            @keyframes crazyFadeOut {
              0% { opacity: 1; }
              70% { opacity: 1; }
              100% { opacity: 0; }
            }
            
            @keyframes bounceIn {
              0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.3);
              }
              50% {
                transform: translate(-50%, -50%) scale(1.05);
              }
              70% {
                transform: translate(-50%, -50%) scale(0.9);
              }
              100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
              }
            }
            @keyframes fadeOut {
              to {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
              }
            }
          `;
          document.head.appendChild(style);
        }

        // ì„ì‹œ ì•Œë¦¼ ë©”ì‹œì§€ í•¨ìˆ˜ (ë” ë¹¡ì¹œ ìŠ¤íƒ€ì¼ë¡œ ì—…ë°ì´íŠ¸)
        function showTemporaryNotification(message) {
          // ê¸°ì¡´ ì•Œë¦¼ì´ ìˆë‹¤ë©´ ì œê±°
          const existingNotification = document.querySelector('.temporary-notification');
          if (existingNotification) {
            existingNotification.remove();
          }
          
          // ìƒˆ ì•Œë¦¼ ìš”ì†Œ ìƒì„±
          const notification = document.createElement('div');
          notification.className = 'temporary-notification';
          notification.textContent = message;
          notification.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ff0000, #ff4500, #ff6600);
            color: white;
            padding: 25px 40px;
            border-radius: 20px;
            font-size: 32px;
            font-weight: 900;
            box-shadow: 0 15px 40px rgba(255,0,0,0.5);
            z-index: 3456789;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            border: 3px solid #ffff00;
            animation: 
              bounceIn 0.6s ease-out,
              crazyShake 0.1s infinite,
              crazyColorChange 0.3s infinite,
              fadeOut 0.5s ease-in 2.5s forwards;
          `;
          
          document.body.appendChild(notification);
          
          // 3ì´ˆ í›„ ìë™ ì œê±°
          setTimeout(() => {
            if (notification.parentNode) {
              notification.remove();
            }
          }, 3000);
        }
      }
    </script>
  </body>
</html>